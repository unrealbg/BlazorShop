@page "/my-cart"
<section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 mb-6">
    @if (_selectedProducts.Any())
    {
        <div class="mt-6 rounded-xl bg-amber-100/60">
            <div class="p-6">
                <h4 class="text-center text-xl font-bold">My Cart</h4>
                <div class="mt-4 overflow-auto">
                    <table class="min-w-full text-sm">
                        <thead>
                            <tr class="bg-neutral-100 text-left">
                                <th class="px-3 py-2">Image</th>
                                <th class="px-3 py-2 w-56">Name</th>
                                <th class="px-3 py-2">Price (€)</th>
                                <th class="px-3 py-2">Quantity</th>
                                <th class="px-3 py-2">Total</th>
                                <th class="px-3 py-2 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-neutral-200">
                            @foreach (var product in _selectedProducts)
                            {
                                Guid productId = product.Id;
                                <tr>
                                    <td class="px-3 py-2 w-40"><img src="@product.Image" alt="@product.Name" class="h-16 w-24 object-contain" /></td>
                                    <td class="px-3 py-2 w-56">@product.Name</td>
                                    <td class="px-3 py-2">€ @product.Price</td>
                                    <td class="px-3 py-2">
                                        <input class="w-20 text-center border rounded px-2 py-1"
                                               type="number"
                                               value="@(GetProductQuantity(productId))"
                                               min="1"
                                               @oninput="(e) => HandleInputChange(e, productId)" />
                                    </td>
                                    <td class="px-3 py-2">€ @GetProductTotalPrice(productId)</td>
                                    <td class="px-3 py-2 text-center">
                                        <button class="text-red-600 hover:text-red-700" title="Remove" @onclick="() => RemoveCartItem(product.Id)">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path d="M6 7h12M9 7V5a2 2 0 012-2h2a2 2 0 012 2v2m-1 0l-1 12a2 2 0 01-2 2h-2a2 2 0 01-2-2L8 7"/></svg>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 flex items-center justify-between">
                    <h4 class="text-lg font-bold">Total: € @(GetGrandTotal(_selectedProducts))</h4>
                    <div>
                        <AuthorizeView>
                            <Authorized>
                                <button class="inline-flex items-center rounded bg-neutral-900 text-white px-4 py-2 font-semibold hover:bg-neutral-800" @onclick="() => _showPaymentDialog = true">Checkout</button>
                            </Authorized>
                            <NotAuthorized>
                                <button class="inline-flex items-center rounded bg-neutral-900 text-white px-4 py-2 font-semibold hover:bg-neutral-800" @onclick="() => Checkout()">Checkout</button>
                            </NotAuthorized>
                        </AuthorizeView>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="mt-16">
            <div class="rounded-xl bg-amber-100/60 p-6">
                <h4 class="text-center text-xl font-bold">My Cart</h4>
                <div class="mt-4 text-center rounded-md bg-yellow-50 text-yellow-800 px-6 py-5 shadow">
                    <h4>Your cart is empty</h4>
                </div>
            </div>
        </div>
    }

    @if (_showPaymentDialog)
    {
        <ModalDialog @bind-IsVisible="_showPaymentDialog">
            <Header>
                <h5 class="text-lg font-semibold">Select Payment Method</h5>
            </Header>
            <Body>
                <ul class="divide-y">
                    @foreach (var paymentMethod in _paymentMethods)
                    {
                        <li class="flex items-center justify-between py-2">
                            @paymentMethod.Name
                            @if (!string.IsNullOrWhiteSpace(_paying))
                            {
                                <span class="text-emerald-600 mr-2">@_paying</span>
                            }
                            else
                            {
                                <button class="inline-flex items-center rounded bg-neutral-900 text-white px-3 py-1 text-sm font-semibold hover:bg-neutral-800" @onclick="() => SelectPaymentMethod(paymentMethod)">Select</button>
                            }
                        </li>
                    }
                </ul>
            </Body>
            <Footer>
                <button class="inline-flex items-center rounded bg-red-600 text-white px-4 py-2 font-semibold hover:bg-red-700" @onclick="Cancel">Cancel</button>
            </Footer>
        </ModalDialog>
    }
</section>
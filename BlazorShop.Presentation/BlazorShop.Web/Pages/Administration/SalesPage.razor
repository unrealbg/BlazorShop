@page "/admin"
@layout AdminLayout

<section class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 mt-8">
  <div class="rounded-xl bg-white/80 shadow p-6" style="height: 600px; overflow: auto">
    <header class="text-center">
      <h2 class="text-2xl font-bold">Sales</h2>
    </header>

    @if (_orderItems.Any())
    {
      var groupByDate = _orderItems.GroupBy(x => x.DatePurchased.Date).ToList();
      decimal grandTotal = 0;

      foreach (var group in groupByDate)
      {
        decimal dailyTotal = group.Sum(x => x.AmountPayed);
        grandTotal += dailyTotal;

        <article class="mt-4 rounded border">
          <div class="px-4 py-2 bg-neutral-100 font-semibold">
            @group.Key.ToShortDateString() - Total: € @dailyTotal.ToString("F2")
          </div>
          <div class="p-4 overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead>
                <tr class="bg-neutral-50 text-left">
                  <th class="px-3 py-2">Name</th>
                  <th class="px-3 py-2">Email</th>
                  <th class="px-3 py-2">Product</th>
                  <th class="px-3 py-2">Quantity</th>
                  <th class="px-3 py-2">Amount (€)</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-neutral-200">
                @foreach (var orderItem in group)
                {
                  <tr>
                    <td class="px-3 py-2">@orderItem.CustomerName</td>
                    <td class="px-3 py-2">@orderItem.CustomerEmail</td>
                    <td class="px-3 py-2">@orderItem.ProductName</td>
                    <td class="px-3 py-2">@orderItem.QuantityOrdered</td>
                    <td class="px-3 py-2">@orderItem.AmountPayed.ToString("F2")</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        </article>
      }

      <footer class="mt-4 text-right font-bold">
        Grand Total: € @grandTotal.ToString("F2")
      </footer>
    }
    else
    {
      <div class="mt-6 rounded-md bg-blue-50 text-blue-800 px-6 py-5 text-center shadow font-semibold">
        No sales data available.
      </div>
    }
  </div>
</section>